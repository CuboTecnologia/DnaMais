@model DNAMais.Domain.DTO.LoginUser
<!DOCTYPE html>
<html>
<head>
    <title>@ViewBag.Title</title>

    <!-- Basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="keywords" content="DNA+" />
    <meta name="description" content="DNA+">
    <meta name="author" content="DNA+">

    <!-- Favicon -->
    <link rel="shortcut icon" href="~/img/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="~/img/apple-touch-icon.png">

    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Web Fonts  -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800%7CShadows+Into+Light" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Handlee' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway:400,500,700' rel='stylesheet' type='text/css'>

    <!-- Vendor CSS -->
    @Styles.Render("~/css/bootstrap")
    <link rel="stylesheet" href="~/vendor/font-awesome/css/font-awesome.min.css">
    @*@Styles.Render("~/css/fontawesome")*@
    @Styles.Render("~/css/simplelineicons")
    @Styles.Render("~/css/carousel")
    @Styles.Render("~/css/magnificpopup")

    <!-- Theme CSS -->
    @Styles.Render("~/css/theme")

    <!-- Current Page CSS -->
    @Styles.Render("~/css/rsplugin")
    @Styles.Render("~/css/circleflipslideshow")

    <!-- Skin CSS -->
    <link rel="stylesheet" href="~/css/skins/default.css">
    @*@Styles.Render("~/css/skins")*@

    <!-- Theme Custom CSS -->
    @Styles.Render("~/css/custom")

    <!-- Head Libs -->
    @Scripts.Render("~/Scripts/modernizr")
    @Scripts.Render("~/Scripts/jquery")


</head>
<body>

    <div class="body">
        <header id="header" data-plugin-options='{"stickyEnabled": true, "stickyEnableOnBoxed": true, "stickyEnableOnMobile": false, "stickyStartAt": 0, "stickySetTop": "0", "stickyChangeLogo": false}'>
            <div class="header-body">
                <div class="header-container container">
                    <div class="header-row">
                        <div class="header-column">
                            <div class="header-logo">
                                <a href="~/Home">
                                    <img class="hidden-xs" alt="DNA+" title="DNA+" width="266" height="69" data-sticky-width="177" data-sticky-height="45" data-sticky-top="33" src="~/img/LogoDNA.png">
                                    <img class="visible-xs" alt="DNA+" title="DNA+" width="250" height="66" data-sticky-width="111" data-sticky-height="28" data-sticky-top="33" src="~/img/LogoDNA.png">
                                </a>
                            </div>
                        </div>
                        <div class="header-column">
                            <div class="header-row">
                                <div class="header-nav">
                                    <button class="btn header-btn-collapse-nav" data-toggle="collapse" data-target=".header-nav-main">
                                        <i class="fa fa-bars"></i>
                                    </button>
                                    <ul class="header-social-icons social-icons hidden-xs">
                                        <li class="social-icons-facebook"><a href="https://www.facebook.com/DNAMais/" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></li>
                                        <li class="social-icons-twitter"><a href="https://twitter.com/dnamais" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></li>
                                        <li class="social-icons-linkedin"><a href="https://www.linkedin.com/company/dna-marketing-solutions" target="_blank" title="Linkedin"><i class="fa fa-linkedin"></i></a></li>
                                    </ul>
                                    <div class="header-nav-main header-nav-main-effect-1 header-nav-main-sub-effect-1 collapse">
                                        <nav>
                                            <ul class="nav nav-pills" id="mainNav">
                                                <li class="dropdown" id="homeMenu">
                                                    <a class="dropdown" href="~/Home">Home
                                                    </a>
                                                </li>
                                                <li class="dropdown" id="servicesMenu">
                                                    <a class="dropdown-toggle" href="@Url.Action("AllServices", "Services")">Serviços
                                                    </a>
                                                    <ul class="dropdown-menu">
                                                        <li><a href="@Url.Action("DataEnrichment", "Services")">Enriquecimento de Dados</a></li>
                                                        <li><a href="@Url.Action("DataTreatment", "Services")">Tratamento e Higienização de Dados</a></li>
                                                        <li><a href="@Url.Action("AssigningDocs", "Services")">Atribuição de Documentos</a></li>
                                                        <li><a href="@Url.Action("QualifiedMailing", "Services")">Mailing Qualificado</a></li>
                                                        <li><a href="@Url.Action("MailMarketing", "Services")">E-mail Marketing</a></li>
                                                        <li><a href="@Url.Action("Sms", "Services")">Sms</a></li>
                                                        <li><a href="@Url.Action("Search", "Services")">Pesquisa CPF / CNPJ</a></li>
                                                        <li><a href="@Url.Action("StatisticalModels", "Services")">Modelos Estatísticos</a></li>
                                                        <li><a href="@Url.Action("ProspectingSolutions", "Services")"><b style="color: #E4322B">Soluções de Prospecção</b></a></li>
                                                    </ul>
                                                </li>
                                                @*<li class="dropdown" id="blogMenu">
                                                        <a class="dropdown" href="@Url.Action("BlogList","Blog")" target="_blank">
                                                            Blog
                                                        </a>
                                                    </li>*@
                                                <li class="dropdown" id="contactMenu">
                                                    <a class="dropdown-toggle" href="#">Contato
                                                    </a>
                                                    <ul class="dropdown-menu">
                                                        <li><a href="@Url.Action("Propose", "Contact")">Solicite uma Proposta</a></li>
                                                        <li><a href="@Url.Action("Location", "Contact")">Localização</a></li>
                                                    </ul>
                                                </li>
                                                <li class="dropdown" id="aboutMenu">
                                                    <a class="dropdown" href="@Url.Action("AboutUs", "About")">Sobre a DNA+
                                                    </a>
                                                </li>
                                                <li class="dropdown" id="loginMenu" data-toggle="modal" data-target="#formModal">
                                                    <a class="dropdown" href="#" target="_blank">Acesse
                                                    </a>
                                                </li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="modal fade" id="formModal" tabindex="-1" role="dialog" aria-labelledby="formModalLabel" aria-hidden="true">
            @using (Html.BeginForm("Index", "Home", FormMethod.Post, new { @id = "formAreaRestrita", @class = "form-horizontal mb-lg", @autocomplete = "off" }))
            {

                <div class="modal-dialog">
                    <div id="divLogin" class="modal-content">
                        <div class="modal-header">
                            <button type="button" id="btnUpClose" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="formModalLabel">Acesse o Sistema</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group mt-lg">
                                <label class="col-sm-3 control-label">Usuário</label>
                                <div class="col-sm-9">
                                    @Html.TextBoxFor(x => x.Login, new { @class = "form-control", @placeholder = "Insira seu usuário" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">Senha</label>
                                <div class="col-sm-9">
                                    @Html.PasswordFor(x => x.Password, new { @class = "form-control", @placeholder = "Insira sua senha" })
                                </div>
                            </div>
                            <div class="text-right">
                                <a href="#" id="lnkEsqueceuSenha">Esqueceu sua senha?</a>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span id="loadingImage"></span>
                            <button type="button" id="btnClose" class="btn btn-default" data-dismiss="modal">Fechar</button>
                            <button type="button" id="btnLogin" class="btn btn-primary">Efetuar Login</button>
                        </div>
                        <div id="messageError" class="alert alert-danger collapse" role="alert" style="margin-left: 20px; margin-right: 20px;">
                            <strong>Alerta!&nbsp;</strong>Usuário ou senha inválidos.
                        </div>
                    </div>
                    <div id="divAlterarSenha" class="modal-content hide">
                        <div class="modal-header">
                            <button type="button" id="btnUpCloseSenha" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="formModalLabelSenha">Alteração de Senha</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group mt-lg">
                                <label class="col-sm-4 control-label">Nova Senha</label>
                                <div class="col-sm-8">
                                    @Html.PasswordFor(x => x.NewPassword, new { @class = "form-control", @placeholder = "Insira sua nova senha" })
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-4 control-label">Confirmação da Senha</label>
                                <div class="col-sm-8">
                                    @Html.PasswordFor(x => x.ConfirmNewPassword, new { @class = "form-control", @placeholder = "Digite novamente a nova senha" })
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span id="loadingImageSenha"></span>
                            <button type="button" id="btnCloseSenha" class="btn btn-default" data-dismiss="modal">Fechar</button>
                            <button type="button" id="btnSalvarSenha" class="btn btn-primary jsSalvarSenha">Gravar</button>
                        </div>
                        <div id="messageErrorSenha" class="alert alert-danger collapse hide" role="alert" style="margin-left: 20px; margin-right: 20px;">
                            <strong>Alerta!&nbsp;</strong><span id="textoMensagem">Senhas não conferem.</span>
                        </div>
                    </div>
                    <div id="divEsqueceuSenha" class="modal-content hide">
                        <div class="modal-header">
                            <button type="button" id="btnUpCloseEsqueceuSenha" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h4 class="modal-title" id="formModalLabelEsqueceuSenha">Gerar nova Senha</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group mt-lg">
                                <label class="col-sm-2 control-label">E-mail</label>
                                <div class="col-sm-10">
                                    @Html.TextBoxFor(x => x.Email, new { @class = "form-control", @placeholder = "Digite o seu e-mail de cadastro" })
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <span id="loadingImageEsqueceuSenha"></span>
                            <button type="button" id="btnCloseEsqueceuSenha" class="btn btn-default" data-dismiss="modal">Fechar</button>
                            <button type="button" id="btnEnviarNovaSenha" class="btn btn-primary">Enviar nova senha</button>
                        </div>
                        <div id="messageErrorEsqueceuSenha" class="alert alert-danger collapse hide" role="alert" style="margin-left: 20px; margin-right: 20px;">
                            <strong>Alerta!&nbsp;</strong><span id="textoMensagemEsqueceuSenha">Digite o seu e-mail de cadastro.</span>
                        </div>
                    </div>
                </div>
            }
        </div>

        <div class="modal" id="formModalQsa" tabindex="-1" role="dialog" aria-labelledby="formModalLabelQsa" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" id="btnUpCloseQsa" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="formModalLabelQsa">Detalhes</h4>
                    </div>
                    <div id="modalQsaBody" class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btnCloseQsa" class="btn btn-default" data-dismiss="modal">Fechar</button>
                    </div>
                </div>
            </div>
        </div>

        @RenderBody()

        <footer id="footer">
            <div class="container">
                <div class="row">
                    <div class="footer-ribbon">
                        <span>Entre em Contato</span>
                    </div>

                    @*<a href="@Url.Action("SubscriptionEmailNewsletter","Newsletter")">NEWSLETTER TESTE</a>*@

                    @Html.Partial("_NewsletterFooter")

                    <div class="col-md-3">
                        <h4>Solicite uma Proposta</h4>
                        <div id="tweet" class="twitter" data-plugin-tweets data-plugin-options='{"username": "", "count": 2}'>
                            <p>Nossos colaboradores o ajudarão a encontrar a melhor opção de contratação para as suas necessidades.</p>
                            <p>Para isso, clique <a href="@Url.Action("Propose", "Contact")">aqui!</a></p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="contact-details">
                            <h4>Contate-nos</h4>
                            <ul class="contact">
                                <li>
                                    <p><i class="fa fa-map-marker"></i><strong>Endereço:</strong> Av. Brigadeiro Luiz Antonio, 2696, Conj.401 - Jardim Paulista / São Paulo - SP</p>
                                </li>
                                <li>
                                    <p><i class="fa fa-phone"></i><strong>Telefone:</strong> +55 11 3211-2202</p>
                                    <p><i class="fa fa-phone"></i><strong>Telefone:</strong> +55 11 2039-1550</p>
                                </li>
                                <li>
                                    <p><i class="fa fa-envelope"></i><strong>Email:</strong> <a href="mailto:contato@dnamais.com.br">contato@dnamais.com.br</a></p>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <h4>Siga</h4>
                        <ul class="social-icons">
                            <li class="social-icons-facebook"><a href="https://www.facebook.com/DNAMais/" target="_blank" title="Facebook"><i class="fa fa-facebook"></i></a></li>
                            <li class="social-icons-twitter"><a href="https://twitter.com/dnamais" target="_blank" title="Twitter"><i class="fa fa-twitter"></i></a></li>
                            <li class="social-icons-linkedin"><a href="https://www.linkedin.com/company/dna-marketing-solutions" target="_blank" title="Linkedin"><i class="fa fa-linkedin"></i></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-md-2">
                            <a href="@Url.Action("Index", "Home")" class="logo">
                                <img alt="DNA+" class="img-responsive" src="~/img/LogoDnaMaisFooter.png">
                            </a>
                        </div>
                        <div class="col-md-7">
                            <p>© Copyright @DateTime.Now.Year. Todos os direitos reservados.</p>
                        </div>
                        @*<div class="col-md-3">
                                <nav id="sub-menu">
                                    <ul>
                                        <li><a href="#">FAQ's</a></li>
                                        <li><a href="#">Mapa do Site</a></li>
                                        <li><a href="#">Contato</a></li>
                                    </ul>
                                </nav>
                            </div>*@
                    </div>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>


<!-- Vendor -->
@Scripts.Render("~/Scripts/bootstrap")
@Scripts.Render("~/Scripts/common")
@Scripts.Render("~/Scripts/carousel")
@Scripts.Render("~/Scripts/vide")

<!-- Contract Services -->
@Scripts.Render("~/Scripts/contractServices")

<!-- Theme Base, Components and Settings -->
@Scripts.Render("~/Scripts/theme")

<!-- Current Page Vendor and Views -->
@Scripts.Render("~/Scripts/rsplugin")
@Scripts.Render("~/Scripts/circleflipslideshow")
@Scripts.Render("~/Scripts/views")

<!-- Theme Custom -->
@Scripts.Render("~/Scripts/custom")

<script>

    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-74422480-2', 'auto');
    ga('send', 'pageview');

</script>

<script>

    $("#formModal").on("shown.bs.modal", function () {
        $('#divLogin').removeClass('hide');
        $('#divLogin').show();
        $('#divAlterarSenha').hide();
        $('#divEsqueceuSenha').hide();
        setTimeout(function () {
            $("#Login").focus();
        }, 500);
    });

    $.jMaskGlobals = {
        maskElements: 'input,td,span,div',
        dataMaskAttr: '*[data-mask]',
        dataMask: true,
        watchInterval: 300,
        watchInputs: true,
        watchDataMask: false,
        byPassKeys: [9, 16, 17, 18, 36, 37, 38, 39, 40, 91],
        translation: {
            '0': { pattern: /\d/ },
            '9': { pattern: /\d/, optional: true },
            '#': { pattern: /\d/, recursive: true },
            'A': { pattern: /[a-zA-Z0-9]/ },
            'S': { pattern: /[a-zA-Z]/ }
        }
    };

    function AjaxInit() {

        $(document).on("click", ".jsSalvarSenha", function (e) {
            e.preventDefault();

            if ($("#NewPassword").val() == "" || $("#ConfirmNewPassword").val() == "") {
                $("#textoMensagem").html("Informe a nova senha e a confirmação");
                $('#messageErrorSenha').removeClass('hide');
                $("#messageErrorSenha").show();
                $("#NewPassword").focus();
            } else if ($("#NewPassword").val() != $("#ConfirmNewPassword").val()) {
                $("#textoMensagem").html("As senhas digitadas não conferem.");
                $('#messageErrorSenha').removeClass('hide');
                $("#messageErrorSenha").show();
                $("#ConfirmNewPassword").focus();
            } else {
                $.ajax({
                    type: "POST",
                    url: "@Url.Action("ChangePassword", "Home")",
                    data: $('#formAreaRestrita').serialize(),
                    cache: false,
                    beforeSend: function () {
                        $("#messageError").hide();
                        $('#btnSalvarSenha').prop("disabled", true);
                        $('#loadingImage').html("<img src='/img/loading.gif' />");
                    },
                    success: function (response) {
                        if (response != null && response.success) {
                            location.href = "@Url.Action("ProdutosContratados", "AreaRestrita")";
                    } else {
                        $("#messageErrorSenha").show();
                        $('#btnSalvarSenha').prop("disabled", false);
                        $('#loadingImage').html("");
                    }
                    },
                    error: function () {
                        $('#btnSalvarSenha').prop("disabled", false);
                        toastr['error']("failure");
                    }
                });
        }

        });

    $(document).on("click", "#btnEnviarNovaSenha", function (e) {
        e.preventDefault();

        if ($("#Email").val() == "") {
            $("#textoMensagemEsqueceuSenha").html("Informe o seu e-mail de cadastro");
            $('#messageErrorEsqueceuSenha').removeClass('hide');
            $("#messageErrorEsqueceuSenha").show();
            $("#Email").focus();
        } else {
            $.ajax({
                type: "POST",
                url: "@Url.Action("SendNewPassword", "Home")",
                data: $('#formAreaRestrita').serialize(),
                cache: false,
                beforeSend: function () {
                    $("#messageErrorEsqueceuSenha").hide();
                    $('#btnEnviarNovaSenha').prop("disabled", true);
                    $('#loadingImage').html("<img src='/img/loading.gif' />");
                },
                success: function (response) {
                    if (response != null && response.success) {
                        location.href = "@Url.Action("ProdutosContratados", "AreaRestrita")";
                    } else {
                        $("#messageErrorEsqueceuSenha").show();
                        $('#btnEnviarNovaSenha').prop("disabled", false);
                        $('#loadingImage').html("");
                    }
                    },
                error: function () {
                    $('#btnEnviarNovaSenha').prop("disabled", false);
                    toastr['error']("failure");
                }
            });
        }

        });

    $('#loginMenu').on('click', function () {
        $(this).addClass('active');
    });

    $(document).keyup(function (e) {
        if (e.keyCode == 27) {
            $('#loginMenu').removeClass('active');
        }
    });

    $('#btnClose').on('click', function () {
        $('#loginMenu').removeClass('active');
    });

    $('#btnUpClose').on('click', function () {
        $('#loginMenu').removeClass('active');
    });

    $('#btnCloseSenha').on('click', function () {
        $('#loginMenu').removeClass('active');
    });

    $('#btnUpCloseSenha').on('click', function () {
        $('#loginMenu').removeClass('active');
    });

    $('#lnkEsqueceuSenha').on('click', function () {
        $('#divLogin').hide();
        $('#divEsqueceuSenha').removeClass('hide');
        $('#divEsqueceuSenha').show();

        setTimeout(function () {
            $('#Email').focus();
        }, 500);

    });

        //$('body').on('click', function () {

        //    if ($('#loginMenu').hasClass('active')) {
        //        $(this).removeClass('active');
        //    }

        //});

    $('#Login').keypress(function () {
        $("#messageError").hide();
    });

    $('#formModal').keydown(function (event) {
        var keyCode = (event.keyCode ? event.keyCode : event.which);
        if (keyCode == 13) {
            $('#btnLogin').trigger('click');
        }
    });

    $('#Password').keypress(function (event) {
        $("#messageError").hide();
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == '13') {
            $('#btnLogin').click();
        }
    });

    $('#btnLogin').on('click', function (e) {
        e.preventDefault();

        if ($("#Login").val() != "" && $("#Password").val() != "") {
            $.ajax({
                type: "POST",
                url: "@Url.Action("Index", "Home")",
                data: $('#formAreaRestrita').serialize(),
                cache: false,
                beforeSend: function () {
                    $("#messageError").hide();
                    $('#btnLogin').prop("disabled", true);
                    $('#loadingImage').html("<img src='/img/loading.gif' />");
                },
                success: function (response) {
                    if (response != null && response.success) {
                        if (response.changePassword) {
                            $('#btnLogin').prop("disabled", false);
                            $('#loadingImage').html("");

                            $('#divAlterarSenha').removeClass('hide');
                            $('#divAlterarSenha').show();
                            $('#divLogin').hide();
                            $('#divEsqueceuSenha').hide();

                            setTimeout(function () {
                                $('#NewPassword').focus();
                            }, 500);

                        } else {
                            location.href = "@Url.Action("ProdutosContratados", "AreaRestrita")";
                        }
                    } else {
                        $("#messageError").show();
                        $('#btnLogin').prop("disabled", false);
                        $('#loadingImage').html("");
                    }
                },
                error: function () {
                    $('#btnLogin').prop("disabled", false);
                    toastr['error']("failure");
                }
            });
        } else {
            $("#messageError").show();
        }

    });

    $('#formModal').on('shown.bs.modal', function () {
        $("#Login").val("");
        $("#Password").val("");
    });
}

$(function () {
    AjaxInit();
});

</script>
